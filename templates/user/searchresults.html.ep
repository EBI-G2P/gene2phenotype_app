%= include 'header'
%= include 'search'

<div class="container">
  <% if (! defined $search_results) { %>
    <h3>No search results for <%= $search_term %></h3>
    <p>If you are expecting results please contact <a href="mailto:g2p-help@ebi.ac.uk">g2p-help@ebi.ac.uk</a>.</p>
    <h3>Search results for <%= $search_term %></h3>
  <% } elsif  ( scalar @{$search_results->{gfd_results}} == 0) { %>
    <h3>No result for <%= $search_term %>. Information about this <%= $search_term %> not yet in G2P</h3>
    %= form_for '/gene2phenotype/gfd/show_add_new_entry_form' => begin
      <input id="button" type="submit" class="btn btn-primary" value="Add New Gene Disease Entry"/>
    %end
  <% } else { %>
    <h3>Search results for <%= $search_term %></h3>
    <% my $gene_symbols; %>
    <table class="table table-bordered table-condensed">
      <thead>
        <tr>
          <th scope="col">Gene symbol</th>
          <th scope="col">Genotype</th>
          <th scope="col">Mutation consequence</th>
          <th scope="col">Disease</th>
          <th scope="col">Panels</th>
          <th scope="col">Go to page</th>
        </tr>
      </thead>
      <tbody>
        <% foreach my $gfd (sort {$a->{panels} cmp $b->{panels} || $a->{gene_symbol} cmp $b->{gene_symbol} || $a->{genotype} cmp $b->{genotype} || $a->{mechanism} cmp $b->{mechanism}}   @{$search_results->{gfd_results}}) { %>
          <% $gene_symbols->{$gfd->{gene_symbol}} = 1; %>
          <tr>
            <td><%= $gfd->{gene_symbol} %></td>
            <td><%= $gfd->{genotype} %></td>
            <td><%= $gfd->{mechanism} %></td>
            <td><%= $gfd->{disease_name} %></td>
            <td><%= $gfd->{panels} %></td>
            <td>
              %= form_for '/gene2phenotype/gfd' => (id => $gfd->{dbID}) => begin
                %= hidden_field dbID => $gfd->{dbID}
                <input id="button" type="submit" value="Go to page" class="btn btn-primary btn-sm"/>
              % end
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
      %= form_for '/gene2phenotype/gfd/show_add_new_entry_form' => begin
        <% if (scalar keys %$gene_symbols == 1 ) { %>
          %= hidden_field gene_symbol => (keys %$gene_symbols)[0]
        <% } %>
        <input id="button" type="submit" class="btn btn-primary" value="Add New Gene Disease Entry"/>
      %end
  <% } %>
</div>
%= include 'footer'
